var cueme_db_currIndex=-1;var cueme_db_queue=new Array();var cueme_db_reqMap={};var cueme_db_emptyFn=function(){};var cueme_db_uniqueID_counter=0;var cueme_db_uniqueID_seed=new Date().getTime();var cueme_db_processingEvent=false;function getUniqueID(){return""+cueme_db_uniqueID_seed+"_"+(cueme_db_uniqueID_counter++)}function sqlRequest(b){this.successCallbackFunc=cueme_db_emptyFn;this.errorCallbackFunc=cueme_db_emptyFn;this.req=null;this.params=null;this.command=null;this.silent=null;this.id=b;this.waitForResponse=function(){return(this.silent==="true")?false:true};this.getReqObjStr=a;function a(){var c="";c+="[{";c+=('"cmd":"'+this.command+'"');c+=(',"req":'+this.req);if(this.params!=null){if(this.params.indexOf("{")==0&&this.params.indexOf("}",this.params.length-1)!==-1){c+=(',"params":'+this.params)}else{c+=(',"params":"'+this.params+'"')}}c+="}]";return c}}function cuemesetDbAttrs(j,b,a,g,c,h,d){try{var f=new sqlRequest(h);f.successCallbackFunc=a;f.errorCallbackFunc=g;f.req=j;f.params=b;f.command=c;f.silent=d;cueme_db_reqMap[h]=f;cueme_db_queue.push(h);trigger()}catch(i){console.log("Error trigger:"+i.message)}}function trigger(){var a=getNextDBReq();if(db_hasSendCuemeEvent()&&a!=null&&a!="getNextDBReq"&&a!="empty"){sendCUEMEevent("click","handleDBReqObj",a)}}function getNextDBReq(){cueme_db_processingEvent=false;var b="getNextDBReq";if(cueme_db_currIndex<cueme_db_queue.length-1){try{cueme_db_currIndex++;var d=cueme_db_queue[cueme_db_currIndex];var a=cueme_db_reqMap[d];if(a!=undefined){b=a.getReqObjStr();if(!a.waitForResponse()){clearCuemeSqlReqMap(cueme_db_reqMap,d)}}}catch(c){console.log("Error Reading DB Data :"+c.message)}cueme_db_processingEvent=true}else{b="empty"}return b}function cuemelogDBEvent(b){if(typeof window.CuemeLogger!="undefined"){try{CuemeLogger.debug(b)}catch(a){}}}function invokeSuccessCallback(dbResult){if(dbResult==null){return}try{var currentSqlRequest=null;var batchId=dbResult.bId;var res=dbResult.res;if(batchId!=null){var bIdx=parseInt(dbResult.bIdx);var id=batchId;var batchReq=(id!=null?cueme_db_reqMap[id]:null);currentSqlRequest=batchReq.batchQueue[bIdx]}else{var id=dbResult.id;currentSqlRequest=(id!=null?cueme_db_reqMap[id]:null);if(currentSqlRequest!=null){clearCuemeSqlReqMap(cueme_db_reqMap,id)}}if(currentSqlRequest!=undefined){var command=currentSqlRequest.command;if(command=="execute"){var result=new resObj();if(res!=null){var jsonResObj=res;try{if(typeof res=="string"){res=res.replace(/\n/g,"\\n");res=res.replace(/&/g,"\\&");res=res.replace(/\r/g,"");jsonResObj=eval("("+res+")")}result.rows.length=jsonResObj.Data.length;result.rows.data=jsonResObj}catch(e){}}var successCallbackFunc=currentSqlRequest.successCallbackFunc;try{if(successCallbackFunc!=null&&successCallbackFunc!=undefined){successCallbackFunc(result)}}catch(e){console.log("Error in successCallback handler:"+e.message)}}else{var result=new resObj();var successCallbackFunc=currentSqlRequest.successCallbackFunc;if(successCallbackFunc!=null&&successCallbackFunc!=undefined){successCallbackFunc(result)}}}else{console.log("invokeSuccessCallback: SQL Request Object Not found for id: "+id)}}catch(e){console.log("invokeSuccesscallback error:"+e.message)}}function clearCuemeSqlReqMap(a,b){if(b!=null&&a[b]!=null){delete a[b]}}function invokeErrorCallback(e){if(e==null){return}var c=null;var a=e.bId;var f=e.err;if(a!=null){var h=parseInt(e.bIdx);var g=a;var b=(g!=null?cueme_db_reqMap[g]:null);c=b.batchQueue[h]}else{var g=e.id;c=(g!=null?cueme_db_reqMap[g]:null);if(c!=null){clearCuemeSqlReqMap(cueme_db_reqMap,g)}}if(c==null||c==undefined){console.log("invokeErrorCallback: SQL Request Object Not found for id: "+g)}else{var d=c.errorCallbackFunc;if(d!=null&&d!=undefined){d(f)}}}function invokeBatchStarted(a){var b=(a!=null?cueme_db_reqMap[a]:null);if(b!=null&&b.startCb!=null){b.startCb()}}function invokeBatchComplete(f){var a=f.bId;var b=(a!=null?cueme_db_reqMap[a]:null);if(b!=null&&b.completeCb!=null){var g=f.sIdx;var e=f.fIdx;var c=f.bRes;if(c!=null&&c.length!=null){for(var d=0;d<c.length;d++){invokeSuccessCallback(c[d])}}b.completeCb(g,e);clearCuemeSqlReqMap(cueme_db_reqMap,a)}}function resObj(){this.rows=new a();function a(){this.data=null;this.length=0;this.item=b;function c(d){this.length=d}function b(f){var e=new Object();for(var d in this.data.ColIndex){if(this.data.ColIndex.hasOwnProperty(d)){var g=this.data.ColIndex[d];e[d]=this.data.Data[f][g]}}return e}}}function db_hasSendCuemeEvent(){if(typeof window.sendCUEMEevent!="undefined"&&typeof window.sendCUEMEevent!="unknown"){return true}return false}function setQueryXML(f,d,a,c,b){if(a==null&&c==null){b=true}var h=getUniqueID();var g={id:h,db:f};if(b===true){g.Silent="true"}var e=JSON.stringify(g);cuemesetDbAttrs(e,d,a,c,"setQueryXML",h,b)}function executeSql(h,a,l,k,b,d,i){try{if(b==null&&d==null){i=true}var f=getUniqueID();var c=new Object();c.QueryId=l;if(h!=null){c.db=h}if(a!=null){c.TXNId=a}c.id=f;if(i===true){c.Silent="true"}var j=JSON.stringify(c);if(k==null){k="{}"}cuemesetDbAttrs(j,k,b,d,"execute",f,(i===true?"true":null))}catch(g){console.log("Error in executeSQL: "+g.message)}}function QueryBatch(e){this.startCb=cueme_db_emptyFn;this.completeCb=cueme_db_emptyFn;this.batchIdPrefix=e!=null?e:"batch";this.resMode="batch";this.batchSilent="true";this.id=null;this.useSingleTxn="false";this.ignoreError="false";this.dbName="";this.batchQueue=new Array();this.addBatch=b;this.addQueryToBatch=d;function b(m,g,f,k,h,o,j,n){try{var i=new sqlRequest(o);i.successCallbackFunc=f;i.errorCallbackFunc=k;i.req=m;i.params=g;i.command=h;i.silent=j;if(n===true){this.batchQueue.unshift(i)}else{this.batchQueue.push(i)}}catch(l){console.log("Error trigger:"+l.message)}}this.waitForResponse=function(){return true};this.getReqObjStr=a;function a(){var h="";h+="{";h+=('"bId":"'+this.id+'"');h+=(',"resMode":"'+this.resMode+'"');h+=(',"Silent":"'+this.batchSilent+'"');h+=(',"singleTxnMode":"'+this.useSingleTxn+'"');h+=(',"ignoreErr":"'+this.ignoreError+'"');h+=(',"dbName":"'+this.dbName+'"');h+=(',"bReq":[');for(var g=0;g<this.batchQueue.length;g++){if(g!=0){h+=","}h+="{";var f=this.batchQueue[g];h+=('"cmd":"'+f.command+'"');h+=(',"req":'+f.req);if(f.params!=null){if(f.params.indexOf("{")==0&&f.params.indexOf("}",f.params.length-1)!==-1){h+=(',"params":'+f.params)}else{h+=(',"params":"'+f.params+'"')}delete f.params}h+="}"}h+="]";h+="}";return h}function d(k,f,q,p,g,j,l,n){var o=""+this.batchQueue.length;var i=new Object();i.QueryId=q;if(k!=null){i.db=k}if(f!=null){i.TXNId=f}i.bIdx=o;if(l!=null){i.Silent=l===true?"true":"false"}var m=JSON.stringify(i);if(p==null){p="{}"}var h=null;if(l!=undefined){h=(l===false)?"false":"true"}this.addBatch(m,p,g,j,"execute",o,h,n)}this.addQueryToTop=function(k,l,j,i,f,h,g){this.addQueryToBatch(k,l,j,i,f,h,g,true)};this.addQuery=function(k,l,j,i,f,h,g){this.addQueryToBatch(k,l,j,i,f,h,g,false)};this.setBatchStartCallback=function(f){if(f){this.startCb=f}};this.setBatchCompleteCallback=function(f){if(f){this.completeCb=f}};this.useBatchResultMode=function(){this.resMode="batch"};this.useIndividualResultMode=function(){this.resMode="individual"};this.setBatchSilent=function(f){this.batchSilent=f===false?"false":"true"};this.setSingleTransactionMode=function(f,g){this.useSingleTxn=f===false?"false":"true";this.dbName=g};this.setIgnoreError=function(f){this.ignoreError=f===false?"false":"true"};this.execute=c;function c(){var f=getUniqueID();this.id=this.batchIdPrefix+"_"+f;cueme_db_reqMap[this.id]=this;cueme_db_queue.push(this.id);trigger()}};var evaSecureStorage=window.evaSecureStorage||{};evaSecureStorage.storageName="EvaSecureStorage";evaSecureStorage.migrationFlag="doNotDelete.myblue.evaSecureStorage.migration.complete";evaSecureStorage.storageData=new Object();evaSecureStorage.queryStatus=null;evaSecureStorage.isSecureStorageUsedFlag=false;evaSecureStorage.version="1.3";var migrateLocalStorage=function(e,a){console.log("migrateLocalStorage for num keys="+localStorage.length);var h=true;var c=true;var m=true;var k=new QueryBatch("migrateToEvaSecureStorageBatchQuery",null);k.setBatchSilent(h);k.useBatchResultMode();k.setSingleTransactionMode(c,evaSecureStorage.storageName);k.setIgnoreError(m);k.setBatchCompleteCallback(function(n,i){console.log("evaSecureStorage.migrateLocalStorage() : batch complete "+new Date().getTime());console.log("evaSecureStorage.migrateLocalStorage() : successIds="+n+" failureIds="+i);if(e){e()}});k.setBatchStartCallback(function(){console.log("evaSecureStorage.migrateLocalStorage() : batch started "+new Date().getTime())});k.dbName=evaSecureStorage.storageName;for(var d=0,j=localStorage.length;d<j;++d){console.log(localStorage.getItem(localStorage.key(d)));var g=localStorage.key(d);var l=localStorage.getItem(g);var f=new Object();f.KEY=g;f.VALUE=l;f.LAST_UPDATED_TIME=new Date().getTime().toString();var b=JSON.stringify(f);evaSecureStorage.storageData[g]=l;k.addQuery(evaSecureStorage.storageName,null,"query_setStorageItem",b)}var f=new Object();f.KEY=evaSecureStorage.migrationFlag;f.VALUE="true";f.LAST_UPDATED_TIME=new Date().getTime().toString();var b=JSON.stringify(f);evaSecureStorage.storageData[evaSecureStorage.migrationFlag]="true";k.addQuery(evaSecureStorage.storageName,null,"query_setStorageItem",b);k.execute()};evaSecureStorage.isSecureStorageUsed=function(c){var a=false;if((typeof c=="undefined"||c==null)&&((window.navigator.appVersion.indexOf("Win")!=-1)||(window.navigator.appVersion.indexOf("Mac")!=-1))){a=false}else{var d=/Android/.test(window.navigator.userAgent)?true:false;if(c){if(d){var b=c.id;var e;if(c.version){e=c.version.replace(/\./g,"")}if(b.indexOf("com.openstream")!=-1){if(e<260){a=false}else{a=true}}else{if(e<413){a=false}else{a=true}}}else{a=true}}else{a=false}}evaSecureStorage.isSecureStorageUsedFlag=a;return a};evaSecureStorage.dbComponentReady=function(){console.log("DB component ready"+new Date().getTime())};evaSecureStorage.init=function(b,d,c){var a=evaSecureStorage.isSecureStorageUsed(b);console.log("evaSecureStorage :: isSecureStorageUsed="+a);setTimeout(function(){if(evaSecureStorage.isSecureStorageUsedFlag){evaSecureStorage.initializeStorageData(d,c)}else{if(d){d()}}},1)};evaSecureStorage.initializeStorageData=function(c,a){console.log("getting all storage data ");var b=this;executeSql(b.storageName,null,"query_getAllStorageData",null,function(d){if(d.rows.data){console.log("Initializing storage data count: "+d.rows.data.Data.length);for(var e=0;e<d.rows.data.Data.length;e++){evaSecureStorage.storageData[d.rows.data.Data[e]["1"]]=d.rows.data.Data[e]["2"]}}if(evaSecureStorage.storageData[evaSecureStorage.migrationFlag]!=="true"){migrateLocalStorage()}console.log("EvaSecureStorage : initializeStorageData : onSuccess : "+new Date().getTime());if(c){c()}},function(d){console.log("Failed to get storage data: "+d);console.log("EvaSecureStorage : initializeStorageData : onError : "+new Date().getTime());if(a){a()}})};evaSecureStorage.getItem=function(a){if(localStorage.getItem(a)!=null){return localStorage.getItem(a)}if(!evaSecureStorage.isSecureStorageUsedFlag||typeof window.sendCUEMEevent!=="function"){return localStorage.getItem(a)}else{if(a in evaSecureStorage.storageData){return evaSecureStorage.storageData[a]}else{return null}}};evaSecureStorage.setItem=function(b,a){localStorage.setItem(b,a);if(!evaSecureStorage.isSecureStorageUsedFlag||typeof window.sendCUEMEevent!=="function"){return localStorage.setItem(b,a)}evaSecureStorage.setStorageItem(b,a,function(c){console.log("evaSecureStorage.setItem() : save success for key="+b)},function(c){console.log("evaSecureStorage.setItem() : save failed for key="+b+"::error="+c)})};evaSecureStorage.removeItem=function(a){if(!evaSecureStorage.isSecureStorageUsedFlag||typeof window.sendCUEMEevent!=="function"){localStorage.removeItem(a)}else{if(a in evaSecureStorage.storageData){evaSecureStorage.removeStorageItem(a)}}};evaSecureStorage.clear=function(){if(!evaSecureStorage.isSecureStorageUsedFlag||typeof window.sendCUEMEevent!=="function"){localStorage.clear()}else{evaSecureStorage.clearStorage()}};evaSecureStorage.getStorageItem=function(a,d,b){console.log("evaSecureStorage.getStorageItem() : getting storage item for: "+a);if(!a){console.log("evaSecureStorage.getStorageItem() : key cannot be a null/empty");if(b){b()}}if(!evaSecureStorage.isSecureStorageUsedFlag||typeof window.sendCUEMEevent!=="function"){var e=localStorage.getItem(pkey);if(d){d(e)}return}var c=this;var f=new Object();f.KEY=a;var g=JSON.stringify(f);executeSql(c.storageName,null,"query_getStorageItem",g,function(h){if(h.rows.data){d(h.rows.data.Data[0]["1"])}else{d(null)}},function(){b(null)})};evaSecureStorage.setStorageItem=function(g,a,d,b){console.log("setting storage item: key: "+g);if(!g){console.log("Failed to execute : 2 arguments required.");if(b){b()}}if(!evaSecureStorage.isSecureStorageUsedFlag||typeof window.sendCUEMEevent!=="function"){localStorage.setItem(g,a);if(d){d()}return}var c=this;var e=new Object();e.KEY=g;e.VALUE=a;e.LAST_UPDATED_TIME=new Date().getTime().toString();var f=JSON.stringify(e);executeSql(c.storageName,null,"query_setStorageItem",f,function(h){console.log("save success for key="+g);evaSecureStorage.storageData[g]=a;if(d){d()}},function(h){console.log("save failed for key="+g+"::error="+h);evaSecureStorage.storageData[g]=null;if(b){b()}})};evaSecureStorage.getStoragelength=function(a){console.log("getting number of items in storage.");return Object.keys(this.storageData).length};evaSecureStorage.removeStorageItem=function(a){console.log("removing storage item for: "+a);var b=this;var c=new Object();c.KEY=a;var d=JSON.stringify(c);executeSql(b.storageName,null,"query_removeStorageItem",d,function(){console.log("remove item success.");delete evaSecureStorage.storageData[a]},function(){console.log("remove item failed.")})};evaSecureStorage.clearStorage=function(){console.log("Clearing storage");localStorage.clear();var a=this;executeSql(a.storageName,null,"query_clearAppStorage",null,function(){console.log("clear storage success.");evaSecureStorage.storageData={}},function(){console.log("clear storage failed.")})};